#!/bin/bash
# mnt v0.1

# Only list partitions (not disks) that are not:
#  - sda  (Windows)
#  - nvme (Linux)
#  - sdb  (Data)
options=( $(lsblk -ln -o name,type | grep -vE 'disk|sda|sdb|nvme0' | awk '{print $1}') )
len=${#options[@]}


# Color:
red()   { echo -ne "\e[31m${1}\e[0m" ;}
green() { echo -ne "\e[32m${1}\e[0m" ;}


mount_device()
{
   device="$1"

   # If there's no dir with the name of the mount point,
   # create the directory, and mount the drive to it
   if [[ ! -d /mnt/$device ]] ; then
      sudo bash -c "mkdir /mnt/$device" && \
      sudo bash -c "mount /dev/$device /mnt/$device"
      exit 2
   fi

   # If the dir exists, and something is already mounted to it
   if [[ -d /mnt/$device ]] && [[ $(lsblk -o mountpoint | grep "/mnt/$device") ]] ; then
      red "◆ " ; echo -e "Disk already mounted to /dev/$device."
      exit 3
   fi

   # If the dir exists, but is empty, mount to it
   if [[ -d /mnt/$device ]] && [[ ! $(ls -A /mnt/$device) ]] ; then
      sudo bash -c "mount /dev/$device /mnt/$device"
   fi
}


# Exit 1 -- no devices found
if [[ $len -eq 0 ]] ; then
   red "◆ " ; echo "No devices found"
   exit 1
elif [[ $len -eq 1 ]] ; then
   green "◆ " ; echo "One device found (${options[0]}) -- mounting"
   mount_device ${options[0]}
else
   green "◆ " ; echo -e "Select:"
   PS3="Choose by <number>: "
   select device in "${options[@]}" ; do
      mount_device $device
   done
fi


if [[ $(which xclip) ]] ; then
   echo "cd /mnt/$device ; ls" | xclip -i -selection c
fi
